{% extends "base.html" %}

{% block body_content %}
{{ super() }}

{#
<script src="/static/thirdparty/jquery-migrate/1.1.0/jquery-migrate.min.js"></script>
<script>
$(document).ready(function (){
    $("#forgot_password_form").submit(function(event) {
        // Disable default action for submission
        event.preventDefault();

        // Disable controls to prevent multiple submission requests
        $("#forgot_password_form input").attr("disabled","disabled")
        $("#forgot_password_form button").attr("disabled","disabled")

        // TODO: Notify with loading graphic

        $.ajax({
            type: "POST",
            url : "{{ url_for_security('forgot_password') }}",
            data: { // TODO: fix this to just use $(this).serialize()
                'email': $("#email").val(),
                'csrf_token': $("#csrf_token").val(),
                'submit': $("#submit").val(),
            },
            success : function( data ) {
                console.log("Submission successful");
                // Whether relevant account exists
                // Whether reset successful
                data = JSON.parse(data);
                if(data.hasOwnProperty("error")) {
                    show_alert(data["error"], "error");
                    $("#forgot_password_form input").removeAttr("disabled");
                    $("#forgot_password_form button").removeAttr("disabled");
                }
                if(data.hasOwnProperty("success")) {
                    show_alert("We have sent an e-mail to \"" + $("#email").val() + "\". Please follow the instructions to continue with password reset.", "success");
                }
            },
             error : function (data) {
                console.log("Submission not successful")
                console.log(data)
                show_alert("Unable to process your request ", "error");
             }
        });
    });
});
</script>
#}

<div class="container">
    <div class="row">
        <div class="span8 offset1">
            <h1>Welcome to SlideAtlas</h1>
            <h3>Password Reset Request</h3>
            <p>Please enter the email address associated with your SlideAtlas account.</p>
        </div>
    </div>
    <br/>
    <div class="row">
        <form action="{{ url_for_security('forgot_password') }}" method="POST" id="forgot_password_form">
            <div class="span8 offset1">
                <div class="controls form-inline">
                        {{ forgot_password_form.hidden_tag() }}
                        {{ forgot_password_form.email.label }}
                        {{ forgot_password_form.email(required=True, title="Please enter a valid email.") }}
                        {{ forgot_password_form.submit(class="btn") }}
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}
